"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,a,n){return a&&t(e.prototype,a),n&&t(e,n),e}}(),Ada={init:function(t,e,a){window.Ada=new AdaChaperone(t,e,a),console.warn("Ada.init() is deprecated. Please use the AdaChaperone class for instantiation described here: https://github.com/AdaSupport/chaperone#set-up")}},AdaChaperone=function(){function t(e){var a=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments[2];if(_classCallCheck(this,t),this.contentFrame=document.createElement("iframe"),this.contentFrame.setAttribute("class","ada-iframe"),this.contentFrame.setAttribute("name","ada-iframe"),this.frameParent=null,this.clientHandle=e,this.isInMobile=null!==navigator.userAgent.match(/(iPad)|(iPhone)|(iPod)|(android)|(webOS)/i),this.chatButton=null,this.frameParentVisible=!1,this.usingCustomElement=!1,this.chatApplicationLoaded=!1,this.client=null,this.afterChatLoadTasks=[],this.chatAppURL="https://"+this.clientHandle+".ada.support/chat/",this.customChatStyles=n.customStyles,"string"!=typeof this.clientHandle||0===this.clientHandle.length)throw"Unable to initialize Ada. Parameter 'clientHandle' should be a string that matches the client handle for your Ada bot";window.onload=function(){a.fetchClient(a.clientHandle,function(t){if(a.client=t,a.client.chat===!1)throw"Sorry, please turn on the web chat integration in your bot's settings";a.setUpFrameParent(n.parentElement),a.mountContentFrameInParent(),a.mountStyleSheet(function(){if(a.usingCustomElement)a.loadChatApplicationIntoContentFrame();else{var t=a.checkRollout();t&&(a.skinDefaultUI(),document.body.appendChild(a.frameParent),window.setTimeout(function(){a.removeClass(a.chatButton,"ada-chat-button--hidden")},500))}}),"undefined"!=typeof o&&o(a)})}}return _createClass(t,[{key:"checkRollout",value:function(t){if("undefined"!==this.client.rollout){var e=this.readRollout(),a="undefined"!=typeof t?t:Math.random();if(null===e.group||0===e.lastProb){var n=a<=this.client.rollout,o=n?"B":"A",i=this.client.rollout;return this.storeRollout(o,i),n}if("A"===e.group||"B"===e.group){if(null===e.lastProb||e.lastProb===this.client.rollout)return"B"===e.group;if(0===this.client.rollout)return this.storeRollout("A",0),!1;if(1===this.client.rollout)return this.storeRollout("B",1),!0;if(this.client.rollout<e.lastProb){if("B"===e.group){var r=1-this.client.rollout/e.lastProb,s=r>=a,l=s?"B":"A";return this.storeRollout(l,this.client.rollout),s}}else if(this.client.rollout>e.lastProb&&"A"===e.group){var d=1-e.lastProb/this.client.rollout,h=d>=a,c=h?"B":"A";return this.storeRollout(c,this.client.rollout),h}}}return!0}},{key:"storeRollout",value:function(t,e){try{window.localStorage.setItem(this.clientHandle+"_ada_chap_rollout_group",t),window.localStorage.setItem(this.clientHandle+"_ada_chap_rollout_last_prob",e)}catch(t){return null}}},{key:"readRollout",value:function(){var t={group:null,lastProb:null};try{return t.group=window.localStorage.getItem(this.clientHandle+"_ada_chap_rollout_group"),t.lastProb=JSON.parse(window.localStorage.getItem(this.clientHandle+"_ada_chap_rollout_last_prob")),t}catch(e){return t}}},{key:"fetchClient",value:function(t,e){var a=new XMLHttpRequest,n="https://"+t+".ada.support/api/";if("withCredentials"in a)a.open("GET",n,!0);else{if("undefined"==typeof XDomainRequest)return void(a=null);a=new XDomainRequest,a.open("GET",n)}a.onload=function(){var t=JSON.parse(a.responseText);t.client?e(t.client):console.warn("No client object found")},a.send()}},{key:"skinDefaultUI",value:function(){this.client.tint&&this.client.tint.length>0?this.chatButton.setAttribute("style","background-color: "+this.client.tint+"!important;"):this.chatButton.setAttribute("style","background-color: #23bbda!important;"),this.client.name&&this.client.name.length>0?this.chatButton.alt="Chat with "+this.client.name:this.chatButton.alt="Chat with Ada"}},{key:"setUpFrameParent",value:function(t){if("string"==typeof t){var e=document.getElementById(t);if(!e)throw"Unable to initialize Ada. An element with id '"+t+"' could not be found";this.frameParent=e,this.usingCustomElement=!0}else t instanceof HTMLElement?(this.frameParent=t,this.usingCustomElement=!0):(this.frameParent=document.createElement("div"),this.frameParent.setAttribute("style","background-color: white;"),this.mountDefaultUI())}},{key:"mountContentFrameInParent",value:function(){this.addClass(this.contentFrame,"ada-iframe"),this.frameParent.appendChild(this.contentFrame)}},{key:"mountStyleSheet",value:function(t){var e=document.createElement("style");e.type="text/css",e.appendChild(document.createTextNode(adaStylesheet)),document.head.appendChild(e),t()}},{key:"mountDefaultUI",value:function(){var t=this;this.addClass(this.frameParent,"ada-chat-window"),this.addClass(this.frameParent,"ada-chat-window--hidden");var e=document.createElement("button");this.addClass(e,"ada-close-button"),e.title="Close chat window",e.onclick=function(){t.hide()},this.frameParent.appendChild(e),this.chatButton=document.createElement("button"),this.chatButton.setAttribute("style","display:none;"),this.addClass(this.chatButton,"ada-chat-button"),this.addClass(this.chatButton,"ada-chat-button--hidden"),this.chatButton.onclick=function(e){t.show(e)},document.body.appendChild(this.chatButton)}},{key:"loadChatApplicationIntoContentFrame",value:function(){var t=this;this.chatApplicationLoaded||(this.contentFrame.src=this.chatAppURL,this.chatApplicationLoaded=!0,this.contentFrame.onload=function(){for(var e=t.afterChatLoadTasks.length-1;e>=0;e--)t.afterChatLoadTasks[e](),t.afterChatLoadTasks.splice(e,1);t.customChatStyles&&t.tellFrameTo({styles:t.customChatStyles})})}},{key:"hide",value:function(){var t=this;this.addClass(this.frameParent,"ada-chat-window--hidden"),this.removeClass(this.chatButton,"ada-chat-button--hidden"),this.removeClass(document.body,"ada-frozen"),this.frameParentVisible=!1,this.tellFrameTo("blur"),document.body.removeEventListener("click",function(){t.closeChatWindowFromClickOutside()},!1)}},{key:"show",value:function(t){var e=this;"undefined"!=typeof t&&t.stopPropagation(),this.isInMobile?window.open(this.chatAppURL):(this.afterChatLoadTasks.push(function(){e.tellFrameTo("focus")}),this.loadChatApplicationIntoContentFrame(),this.removeClass(this.frameParent,"ada-chat-window--hidden"),this.addClass(this.chatButton,"ada-chat-button--hidden"),this.addClass(document.body,"ada-frozen"),this.frameParentVisible=!0,document.body.addEventListener("click",function(){e.closeChatWindowFromClickOutside()},!1))}},{key:"tellFrameTo",value:function(t){var e=this;this.chatApplicationLoaded?this.contentFrame.contentWindow.postMessage(t,"*"):this.afterChatLoadTasks.push(function(){e.tellFrameTo(t)})}},{key:"setMetaField",value:function(t,e){var a={};a[t]=e,this.tellFrameTo(a)}},{key:"closeChatWindowFromClickOutside",value:function(){this.frameParentVisible&&this.hide()}},{key:"addClass",value:function(t,e){var a=t.className;""!=a&&(e=" "+e),t.className=a+e}},{key:"removeClass",value:function(t,e){var a=new RegExp("(\\s|^)"+e+"(\\s|$)");t.className=t.className.replace(a," ")}}]),t}(),adaStylesheet='body:after{content:\'\';width:100%;height:100%;position:fixed;top:0;left:0;visibility:hidden;opacity:0;background-color:rgba(0,0,0,0.16);z-index:9998;pointer-events:none;transition:all 200ms ease;-webkit-backdrop-filter:grayscale(0)}body.ada-frozen{overflow:hidden;pointer-events:none}body.ada-frozen:after{visibility:visible;opacity:1;pointer-events:all;-webkit-backdrop-filter:grayscale(100%)}.ada-iframe{border:0;outline:0;width:100%;height:100%;box-sizing:border-box;z-index:9998}.ada-chat-window{display:block;height:100vh;width:100%;max-width:375px;position:fixed;bottom:0;right:0;box-sizing:border-box;z-index:9999;box-shadow:-1px 0 0 rgba(0,0,0,0.1),-3px 0 9px rgba(0,0,0,0.15);pointer-events:all;transform:translate(0,0);-webkit-transition:-webkit-transform 200ms ease,opacity 200ms ease;transition:transform 200ms ease,opacity 200ms ease}.ada-chat-window--hidden{transform:translate(375px,0);-webkit-transform:translate(375px,0);-moz-transform:translate(375px,0);opacity:0}.ada-chat-window .ada-close-button{position:absolute !important;top:12px !important;right:12px !important;width:24px !important;height:24px !important;background-color:transparent !important;border:none !important;cursor:pointer !important;background-image:url("https://d124s1zbdqkqqe.cloudfront.net/CloseButton.svg") !important;background-size:cover;z-index:9999 !important;opacity:.5;transition:opacity 200ms ease !important;padding:0;margin:0}.ada-chat-window .ada-close-button:hover{opacity:1}.ada-chat-button{width:44px !important;height:44px !important;background-color:#23bbda !important;background:none !important;border-radius:50% !important;position:fixed !important;bottom:24px !important;right:24px !important;outline:none !important;z-index:10000 !important;cursor:pointer !important;overflow:hidden !important;border:1px solid rgba(0,0,0,0.05) !important;background-image:url("https://d124s1zbdqkqqe.cloudfront.net/Dialogue.svg") !important;background-size:28px !important;background-repeat:no-repeat !important;background-position:center !important;transition:all 120ms ease !important;box-shadow:0 2px 4px rgba(0,0,0,0.1) !important;visibility:visible;padding:0;margin:0}.ada-chat-button:after{content:"" !important;width:46px !important;height:46px !important;position:absolute !important;top:-1px !important;left:-1px !important;opacity:0 !important;border:1px solid rgba(0,0,0,0.05) !important;background-color:rgba(0,0,0,0.1) !important;transition:opacity 120ms ease !important}.ada-chat-button:active{transform:scale(0.94) !important}.ada-chat-button:hover:after{opacity:1 !important}.ada-chat-button--hidden{opacity:0 !important;pointer-events:none !important;visibility:hidden}';